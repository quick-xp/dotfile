#!/bin/bash
# GitHub ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ä¸€è¦§

# è‰²å®šç¾©
CYAN='\033[36m'
YELLOW='\033[33m'
GREEN='\033[32m'
DIM='\033[2m'
RESET='\033[0m'

result=$(gh search prs --review-requested=@me --state=open \
  --json repository,title,createdAt,number \
  --jq '.[] | select(.repository.nameWithOwner | startswith("quick-xp/") | not) | "\(.repository.nameWithOwner)\t\(.number)\t\(.title)\t\(.createdAt | fromdateiso8601 | strflocaltime("%m/%d %H:%M"))"')

if [[ -z "$result" ]]; then
  echo -e "${GREEN}âœ“ ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡ã® PR ã¯ã‚ã‚Šã¾ã›ã‚“${RESET}"
  exit 0
fi

count=$(echo "$result" | wc -l | tr -d ' ')
echo -e "${YELLOW}ğŸ“‹ ãƒ¬ãƒ“ãƒ¥ãƒ¼å¾…ã¡: ${count}ä»¶${RESET}\n"

echo "$result" | while IFS=$'\t' read -r repo number title date; do
  echo -e "${CYAN}${repo}${RESET} ${DIM}#${number}${RESET}"
  echo -e "  ${title}"
  echo -e "  ${DIM}${date}${RESET}"
  echo ""
done
